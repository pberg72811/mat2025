#------------------------------------------------------------------------------------------------
# Common make file code.
#------------------------------------------------------------------------------------------------
LIBRARY_   = $(LIBRARY).so
LIBRARYAR_ = $(LIBRARY).a
OCTAVELIB_ = $(OCTAVELIB).oct
JAVACLASS_ = $(JAVACLASS).class

.SUFFIXES : .asm .class .java

#------------------------------------------------------------------------------------------------
# What to do to get from *.asm to *.o.
#------------------------------------------------------------------------------------------------
.asm.o :
	$(ASM) $(ASMFLAGS) $(INCDIRS) $<

#------------------------------------------------------------------------------------------------
# What to do to get from *.c to *.o.
#------------------------------------------------------------------------------------------------
.c.o :
	$(CC) $(CCFLAGS) $(DEFINES) $(INCDIRS) -c $<

#------------------------------------------------------------------------------------------------
# What to do to get from *.cc to *.o.
#------------------------------------------------------------------------------------------------
.cc.o :
	$(CC) $(CCFLAGS) $(DEFINES) $(INCDIRS) -c $<

#------------------------------------------------------------------------------------------------
# What to do to get from *.cpp to *.o. Same as above.
#------------------------------------------------------------------------------------------------
.cpp.o :
	$(CC) $(CCFLAGS) $(DEFINES) $(INCDIRS) -c $<

#------------------------------------------------------------------------------------------------
# What to do to get from *.java to *.class.
#------------------------------------------------------------------------------------------------
.java.class :
	$(CC) $(JAVACFLAGS) $<

#------------------------------------------------------------------------------------------------
# What to do to build an executable.
#------------------------------------------------------------------------------------------------
$(EXECUTABLE): $(OBJS) $(LIBS)
	$(CC)  $(OBJS) $(LIBS) $(LIBDIRS) $(LKFLAGS) -o $(EXECUTABLE)
	cp -p $(EXECUTABLE) $(THESWD)/bin
	@echo "*********************************************************************************"
	@echo "Done with $(EXECUTABLE)"
	@echo "*********************************************************************************"

#------------------------------------------------------------------------------------------------
# What to do to build a shared library. Includes PYTHON shared libraries.
#------------------------------------------------------------------------------------------------
$(LIBRARY_): $(OBJS) $(LIBS)
	$(CC)  $(OBJS) $(LIBS) $(LIBDIRS) -o lib$(LIBRARY).so -shared
	cp -p lib$(LIBRARY).so $(THESWD)/lib
	ar -r lib$(LIBRARY).a $(OBJS)
	cp -p lib$(LIBRARY).a $(THESWD)/lib
	@echo "*********************************************************************************"
	@echo "Done with $(LIBRARY_)"
	@echo "*********************************************************************************"

#------------------------------------------------------------------------------------------------
# What to do to build an octave shared library.
#------------------------------------------------------------------------------------------------
$(OCTAVELIB_): $(OBJS) $(LIBS)
	$(CC) $(OBJS) $(LIBS) $(CCFLAGS) $(LKFLAGS) $(DEFINES) -o $(OCTAVELIB_)
	cp -p $(OCTAVELIB_) $(THESWD)/oct
	@echo "*********************************************************************************"
	@echo "Done with $(OCTAVELIB_)"
	@echo "*********************************************************************************"

#------------------------------------------------------------------------------------------------
# What to do to compile java code.
#------------------------------------------------------------------------------------------------
$(JAVACLASS_): $(SRCS)

#------------------------------------------------------------------------------------------------
# Clean up.
#------------------------------------------------------------------------------------------------
clean:
	rm -f *.o
	rm -f *.a
	rm -f *.so
	rm -f make.dependencies
	rm -f *.class
	rm -f *.fpp
	rm -f *.oc
	rm -f *.exe
	rm -f *.pyc
	if [ " $(EXECUTABLE)" != " " ]; then (rm -f $(EXECUTABLE); rm -f $(THESWD)/bin/$(EXECUTABLE) ); fi
	if [ $(LIBRARY_)   != .so  ]  ; then (rm -f $(LIBRARY_)  ; rm -f $(THESWD)/lib/lib$(LIBRARY_) )  ; fi
	if [ $(LIBRARYAR_) != .a   ]  ; then (rm -f $(LIBRARYAR_); rm -f $(THESWD)/lib/lib$(LIBRARYAR_) ); fi
	if [ $(OCTAVELIB_) != .oct ]  ; then (rm -f $(OCTAVELIB_); rm -f $(THESWD)/oct/$(OCTAVELIB_) ); fi

#------------------------------------------------------------------------------------------------
# Depends
#------------------------------------------------------------------------------------------------
depend:
	@cat < //dev//null > make.dependencies
	@for i in $(SRCS); do \
		($(CC) $(INCDIRS) $(DEPENDFLAG) $$i >> make.dependencies); done \


-include make.dependencies

#------------------------------------------------------------------------------------------------
# splint!
#------------------------------------------------------------------------------------------------
splint:
	splint *.c -weak $(INCDIRS)


