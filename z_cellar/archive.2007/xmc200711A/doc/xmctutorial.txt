//-----------------------------------------------------------------------------------------------
// XMC X-Midas Tutorial
//-----------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------
// Boot strap procedure.
// Un-tar the xmc option tree.
//-----------------------------------------------------------------------------------------------

To get started with this tutorial "un-tar" the xmc option tree into your home directory.

  tar -zxvf xmc200605A.tgz --directory ~

Copy the xmcTutorial to you home directory.

  cp xmc200605A/doc/xmcTutorial.txt ~

And start reading the "xmcTutorial.txt" file (Yes that would be this file).

//-----------------------------------------------------------------------------------------------
// Not New Software
//-----------------------------------------------------------------------------------------------

It is not uncommon these days for people to hear about some great new software package, so how does hearing about a not so great old software package sound? X-Midas has a history that stretches back to the early to mid 1980s.  X-Midas is currently being used by the air force in several satellite ground stations around the world.  There are hundreds of specialized applications currently in use that rely on X-Midas.  There is little to no argument that there are numerous software packages, programs, and languages that are better then X-Midas.  However, none of these new pieces of software is able to reach far enough and quickly enough into the environment that  X-Midas is being used  to replace X-Midas. 

//-----------------------------------------------------------------------------------------------
// The Basic Gist of this Tutorial
//-----------------------------------------------------------------------------------------------

This tutorial is in the spirit of the "Hello world" program introduce by Brian W. Kernighan and Dennis M. Richie in their book on the "C"  programing language.  This first "C" program has been recreated with just about every new programing language since.  The "Hello world" program did not perform many functions but served to give a new "C" programmer a working example and seed to grow from.  Such will be the case here.

//-----------------------------------------------------------------------------------------------
// The Option Tree
//-----------------------------------------------------------------------------------------------

The option tree is a directory structure that holds new programs and scripts that add new functionality to an existing X-Midas installation.  The option tree directory structure is set up to mimic the X-Midas installation directory structure.  It has the basic form of (using "ls -al"):

drwxr-xr-x   3 steswd users 4096 May  8 13:10 cfg
drwxr-xr-x   5 steswd users 4096 May  8 13:10 dat
drwxr-xr-x   3 steswd users 4096 May  8 13:10 dev
drwxr-xr-x   3 steswd users 4096 May  8 13:10 exp
drwxr-xr-x   3 steswd users 4096 May  8 13:10 host
drwxr-xr-x   4 steswd users 4096 May  8 13:10 inc
drwxr-xr-x  38 steswd users 4096 May  8 13:10 lib
drwxr-xr-x   3 steswd users 4096 May  8 21:23 mcr

//-----------------------------------------------------------------------------------------------
// Grow your own option tree.
//-----------------------------------------------------------------------------------------------

You can perform the examples in this X-Midas tutorial on any server that you have an account and that has an installation of X-Midas.  You will need to be running a "C-Shell" such as "csh" or "tcsh" ("tcsh" is more powerful) because X-Midas only runs under a "C-shell".  

//-----------------------------------------------------------------------------------------------
// Ingredient #1: A ".cshrc" file.
//-----------------------------------------------------------------------------------------------

You will need to have a few environment variables in your "C-shell" start up script ".cshrc". Cut and paste the following ".cshrc" or modify you own:

  gedit ~/.cshrc

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
# BEGIN CUT AND PASTE
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
#  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------

# !/bin/tcsh
#------------------------------------------------------------------------------------------------

#------------------------------------------------------------------------------------------------
# Source globals.
#------------------------------------------------------------------------------------------------
if ( -e /etc/cshrc ) source /etc/cshrc

#------------------------------------------------------------------------------------------------
# User specific aliases and functions
#------------------------------------------------------------------------------------------------
unalias ls
unalias ll
unalias vi

alias ll   'ls -l --color=tty'
alias llh  'ls -lh --color=tty'
alias lla  'ls -al --color=tty'
alias llha 'ls -alh --color=tty'
alias rm   'rm -i'

#------------------------------------------------------------------------------------------------
# Define the Prompt. 
#------------------------------------------------------------------------------------------------
set prompt = "XM:%/>"

#------------------------------------------------------------------------------------------------
# Define the PATH
#------------------------------------------------------------------------------------------------
setenv PATH .
setenv PATH $PATH":.."
setenv PATH $PATH":/bin"
setenv PATH $PATH":/sbin"
setenv PATH $PATH":/usr/bin"
setenv PATH $PATH":/usr/sbin"
setenv PATH $PATH":/usr/exec"
setenv PATH $PATH":/usr/local/bin"
setenv PATH $PATH":/usr/X11R6/bin"

#------------------------------------------------------------------------------------------------
# Define the LOAD LIBRARY PATH.
#------------------------------------------------------------------------------------------------
setenv LD_LIBRARY_PATH .
setenv LD_LIBRARY_PATH $LD_LIBRARY_PATH":/usr/local/lib"

#------------------------------------------------------------------------------------------------
# XMIDAS.  Will require a link to specific xmidas directory.
#------------------------------------------------------------------------------------------------
setenv XMDISK /opt/xmidas                            #
setenv XMOPTS ~/xmopts                               #
alias xms "source $XMDISK/xm/unix/xmstart"           # This is the import stuff for X-Midas.
if(-e /etc/midas.cshrc) source /etc/midas.cshrc      #
setenv PATH $PATH":"$XMOPTS"/xmc/dev"                #

#------------------------------------------------------------------------------------------------
# Define ICE directory.  Will require a link to specific ice directory.
#------------------------------------------------------------------------------------------------
setenv ICEROOT /opt/xmidas/localopts/ice

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
#  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
# END CUT AND PASTE
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------

Source your new startup script to make your environment current.

  source ~/.cshrc

//-----------------------------------------------------------------------------------------------
// X-Midas history directory.
//-----------------------------------------------------------------------------------------------

If you have an ITT installation of X-Midas you will need to create an "xmhistdir" directory in your home account.  X-Midas creates history files that will clutter up your home directory pretty quick.  The "xmhistdir" directories and a few lines to X-Midas shutdown script was added to have these history files pushed off to the "xmhistdir" sub-directory when you end your X-Midas session.

  mkdir ~/xmhistdir

//-----------------------------------------------------------------------------------------------
// Test out your X-Midas installation.
//-----------------------------------------------------------------------------------------------

You should now at least be able to start X-Midas.  To test out your X-Midas installation type the following (assumes c-shell):

  xms
  xm

You should have an X-Midas prompt.  Type "xmend" to get out of the X-Midas shell.

  xmend

//-----------------------------------------------------------------------------------------------
// Creat a local xmopts directory.
//-----------------------------------------------------------------------------------------------

We want to set up an experimental option tree that will not interfere with anyone else using X-Midas.  To start let us set up a few directories in you home account.  In your home directory do the following:

  mkdir ~/xmopts
  mkdir ~/xmopts/myopt001
  mkdir ~/xmopts/myopt001/{cfg,dat,dev,exp,host,inc,lib,mcr}
  ln -s ~/xmopts/myopt001 ~/xmopts/myopt

//-----------------------------------------------------------------------------------------------
// Copy the "xmc" option tree.
//-----------------------------------------------------------------------------------------------

The examples in this tutorial also rely on the option tree called "xmc".  You should have a copy of this option tree in your home directory.  Copy or move  the "xmc" option tree into the newly created xmopts directory.

  mv ~/xmc200605A ~/xmopts/.
  ln -s ~/xmopts/xmc200605A ~/xmopts/xmc

//-----------------------------------------------------------------------------------------------
// X-Midas startup script.
//-----------------------------------------------------------------------------------------------

You will also need you own X-Midas startup script.  This startup script already has modification to add your new experimental option tree to your X-Midas session.  Cut and paste "~/xmstartup.txt" or modify you own:

  gedit ~/xmstartup.txt

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
# BEGIN CUT AND PASTE
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
#  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------

! X-Midas startup macro
!------------------------------------------------------------------------------
startmacro

! Set up the auxillary disks.
! NOTE:  See the "midas.cfg" file for what auxillary disks are set. 
!        If changes are made to "midas.cfg" you need to perform  the 
!        "configure m" command. 
!------------------------------------------------------------------------------
aux 1 all !!!Write aux is 1 and read aux is all
aux ,, +0 !!!Add user directory (0) as a read aux.

! Set up X-Midas option trees.
!------------------------------------------------------------------------------
say "Re-opt XMC option tree. *************************************************"
xmopt xmc ~/xmopts/xmc200605A
say "*************************************************************************"

say "Adding myopt option tree. ***********************************************"
xmopt myopt ~/xmopts/myopt001
say "*************************************************************************"

xmpath xmpy beta ice myopt spot sys ucl

! Set up the X-Midas ramdisk.  See midas.cfg.
!------------------------------------------------------------------------------
result l:ramaux 3

! Set up hardware configuration for ice.
!------------------------------------------------------------------------------
local myhw
fname a:myhw dat hwconfig prm ice
hw file "^{myhw}"

! Make sure the command line editor has INSERT ON set.
! Set other environment variables.
!------------------------------------------------------------------------------
os setenv SHELL         /bin/tcsh
os setenv XM_INSERT     ON
os setenv XM_DEBUGGER "ddd -d $XMAREA/lib/dbgLib"
os setenv XM_DEBUGGER "$XM_DEBUGGER -d $XMAREA/host"
os unsetenv COLORTERM

! Setup Python.
!------------------------------------------------------------------------------
!PYENV

endmacro

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
#  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
# END CUT AND PASTE
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------
// You now need to "translate" your startup script.
//-----------------------------------------------------------------------------------------------

Enter X-Midas in order to translate your startup script.

  xms
  xm
  mtrans %xmstartup

Hopefully no errors occurred.  Jump out of X-Midas until we can get the "myopt" option tree working.

  xmend

//-----------------------------------------------------------------------------------------------
// The "Hello world." X-Midas macro.
//-----------------------------------------------------------------------------------------------

In the "~/xmopts/myopt001/mcr" directory create a text file called "hello_world.txt" with the following contents:

  gedit ~/xmopts/myopt001/mcr/hello_world.txt

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
# BEGIN CUT AND PASTE
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
#  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------

!!----------------------------------------UNCLASSIFIED-------------------------------------------
!! File: hello_world.txt                                                                        -
!!                                                                                              -
!! Desc: This macro says hello and creates a small output file of data.                         -
!!                                                                                              -
!! Args: outputFile  - Not very usefull output file.   <A:>                                     -
!!                                                                                              -
!! Swch: None                                                                                   -
!!                                                                                              -
!! Hist : When       Who  What                                                                  -
!!        05/05/2006 xyz  Initial Code.                                                         -
!!                                                                                              -
!! Note:                                                                                        -
!!                                                                                              -
!! Examples:                                                                                    -
!!                                                                                              -
!!01.0 Description                                                                              -
!!02.0 Requirements                                                                             -
!!03.0 Interfaces                                                                               -
!!04.0 Design Description                                                                       -
!!05.0 Unit Code                                                                                -
!!06.0 Unit Test Plan                                                                           -
!!07.0 Test Results                                                                             -
!!08.0 Build Procedures                                                                         -
!!09.0 Notes                                                                                    -
!!10.0 Reviewers.                                                                               -
!!----------------------------------------UNCLASSIFIED-------------------------------------------
startmacro

!! Say hello.
!!-----------------------------------------------------------------------------------------------
say "Hello world"

!! Create some data.
!!-----------------------------------------------------------------------------------------------
const hello_data sb 1024 42

endmacro

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
#  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
# END CUT AND PASTE
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------
// The configuration file "commands.cfg".
//-----------------------------------------------------------------------------------------------

In the "~/xmopts/myopt001/cfg" directory create a text file called "commands.cfg" with the following contents:

  gedit ~/xmopts/myopt001/cfg/commands.cfg

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
# BEGIN CUT AND PASTE
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
#  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------

!************************************************************************************************
!   Command definition file for X-Midas
!
!   FORMAT
!   Category  Name  Support,#parameters   default1,default2,...,defaultN
!
!   Support Keys:
!   I-Intrinsic      H-Host           G-Gold            M-Macro
!   F-FPS            S-SSP            C-Cray            D-Datastream
!
!   See xmhlp:category.doc for Category codes
!
!************************************************************************************************
15      BUILDOPT*       M,1     ,MYOPT,#A
11      HELLO_WORLD     M,1     ,,,#A

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
#  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
# END CUT AND PASTE
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------
// The build option tree file "buildopt.txt".
//-----------------------------------------------------------------------------------------------

In the "~/xmopts/myopt001/mcr" directory create a text file called "buildopt.txt" with the following contents:

  gedit ~/xmopts/myopt001/mcr/buildopt.txt 

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
# BEGIN CUT AND PASTE
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
#  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v  v
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------

!!-----------------------------------------------------------------------------------------------
!! Macro: buildopt
!!
!! Descr: This is the buildopt macro for the MYOPT option tree.
!! Hist : When       Who  What
!!        11/08/2005 ptb  Initial Code.
!!        03/30/2006 ptb  Created for MYOPT option tree.
!!-----------------------------------------------------------------------------------------------
!! OptDepend: NONE
!!-----------------------------------------------------------------------------------------------
startmacro u:option

!! Need to make sure macros dependancies are taken care of.
!!-----------------------------------------------------------------------------------------------
xmpath xmpy myopt sys

!! Clean out option tree if told to.
!!-----------------------------------------------------------------------------------------------
if /CLEAN gt 0 then
  xmdir mcr ^option                         !! Go to the "mcr" directory of the option tree.
  os "$XMAREA_XMC/bin/clean_xmidas_macros"  !! Call the clean macros script in XMC.
  os cd ..                                  !! Go up one directory
  os pwd
  os find . -name "*.a"   -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "*.o"   -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "*.so"  -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "*.oc"  -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "*.pyc" -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "*.exe" -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "*.fpp" -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "c_*.c" -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  os find . -name "make.dep*" -exec rm -rf '{}' ';'  !! Clean out files in entire option tree.
  say "*********************************"
  say "The $XMAREA_^option is now clean."
  say "*********************************"

!! Else build the libraries and run xm build command for primitives.
!!-----------------------------------------------------------------------------------------------
else
  xmdir lib ^option                        !! Go to the "lib" directory of the option tree
  os cd ..                                 !! Go to the directory above.
  os xmcm lib .                            !! X-Midas common make.
                                           !! Done with libraries.
  xmbld * cld ,, ^option                   !! Now perform an X-Midas build on the primitives.
endif

endmacro

#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------
#  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^  ^
#  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
# END CUT AND PASTE
#------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------
// Creat an explain file.
//-----------------------------------------------------------------------------------------------

The "xmc" option tree has a little tool for creating an explain file.  This tool is not a normal X-Midas tool and it works only on files with the specific header format used in this tutorial.  Go to the "mcr" directory of the myopt and use this tool as follows:

  cd ~/xmopts/myopt/mcr
  xmcMakeExplainFile hello_world.txt ..

Yes the two periods are necessay.  The tool will be looking for an "exp" directory which can be found when you are one directory level higher then "mcr".

//-----------------------------------------------------------------------------------------------
// Give it a shot.
//-----------------------------------------------------------------------------------------------

OK let us see if this thing flys. Perfor the following:

  cd
  xms
  xm
  xmbopt myopt
  hello_world mydata

If you want to see the syntax of your new macro type the following:

  syn hello_world

If you want to see the explain file of your new macro type the following:

  explain hello_world

//-----------------------------------------------------------------------------------------------
// Excellent!
//-----------------------------------------------------------------------------------------------

You have just created an X-Midas option tree.




Other thoughts.

XMFHSISHF
X-Midas can be seen as an environment to work from.  It is in fact a "Shell" program that sits on your operating system "Shell" program.  It was also designed to be cross compatible with VMS and UNIX which is one reason it is also confusing.  From this environment/shell you can call programs or executables (X-Midas speak they are called "Primitives") to perform various functions.  

XMFHSISHF
A good deal of X-Midas is geared towards signal processing and satellite communications.  Therefore, the primitives and macros are manly of the variety to generate signals, process, signals, and keep track of where satellites are.  

XMFHSISHF
Since the beginnings of X-Midas started life before there was such an thing as a graphical user interface (GUI) the controls and Gui's that come with X-Midas have an Clunky appearance and sometimes awkward workings.  Attempts are being made to changes this, however, there is no strong unifying control/GUI mechanism.
